# The main job for capstone_pipeline.
resources:
  jobs:
    capstone_pipeline_job:
      name: capstone_pipeline_job
      email_notifications:
        on_failure:
          - mmanojipec@gmail.com
      trigger:
        pause_status: UNPAUSED
        file_arrival:
          url: s3://capstone-proj-src/files/landing/
          min_time_between_triggers_seconds: 60
      tasks:
        - task_key: Initial_Setup
          notebook_task:
            notebook_path: ../src/00_Initial_Setup.sql
            source: WORKSPACE
        - task_key: 01_Bronze_Ingestion
          depends_on:
            - task_key: Initial_Setup
          notebook_task:
            notebook_path: ../src/01_Bronze_Ingestion.ipynb
            source: WORKSPACE
        - task_key: 02_Silver_Customers
          depends_on:
            - task_key: 01_Bronze_Ingestion
          notebook_task:
            notebook_path: ../src/02_Silver_Customers_SCD2.ipynb
            source: WORKSPACE
        - task_key: 02_Silver_Products
          depends_on:
            - task_key: 01_Bronze_Ingestion
          notebook_task:
            notebook_path: ../src/02_Silver_Products.ipynb
            source: WORKSPACE
        - task_key: 02_Silver_Transactions
          depends_on:
            - task_key: 01_Bronze_Ingestion
          notebook_task:
            notebook_path: ../src/02_Silver_Transaction.ipynb
            source: WORKSPACE
        - task_key: 03_Gold_Sales_Fact_Table
          depends_on:
            - task_key: 02_Silver_Customers
            - task_key: 02_Silver_Products
            - task_key: 02_Silver_Transactions
          notebook_task:
            notebook_path: ../src/03_Gold_Fact_Table.ipynb
            source: WORKSPACE
        - task_key: 04_Gold_Fact_Table
          depends_on:
            - task_key: 03_Gold_Sales_Fact_Table
          notebook_task:
            notebook_path: ../src/04_Gold_Aggregations.ipynb
            source: WORKSPACE
      queue:
        enabled: true
      parameters:
        - name: catalog
          default: TestDemo
      performance_target: PERFORMANCE_OPTIMIZED
      max_concurrent_runs: 4